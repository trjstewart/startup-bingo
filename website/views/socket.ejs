<!doctype html>
<html class="no-js" style="height:100%" lang="">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title></title>
    <meta name="description" content="">
    <!--<meta name="viewport" content="width=device-width, initial-scale=1">-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.4.5/socket.io.min.js"></script>
    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/css/materialize.min.css">

    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/js/materialize.min.js"></script>

    <!--DANK AS FUCK EMOJIS-->
    <script src="/js/emojify.min.js"></script>


    <script>
        var socket = io('http://localhost/');
    </script>
    <style>
        body {
            padding-top: 50px;
            padding-bottom: 20px;
        }
    </style>
    <link rel="stylesheet" href="css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="css/main.css">

    <script src="js/vendor/modernizr-2.8.3.min.js"></script>
</head>
<body>
<!--[if lt IE 8]>

<p class="browserupgrade">filthy ie user gtfo</p>
<![endif]-->

<div class="container">
    <!--<div class="col s12 card-panel teal lighten-2">-->
    <div class="input-form">
        <div class="row">
            <form class="col s12">
                <div class="row">
                    <div class="input-field col s12">
                        <input id="username" type="text" class="validate">
                        <label for="username">Username</label>
                    </div>
                </div>
                <div class="row">
                    <div class="input-field col s12">
                        <input id="room" type="text" class="validate">
                        <label for="room">Event hashtag</label>
                    </div>
                </div>
                <div class="button-container">
                    <a class="submit-button waves-effect waves-light btn-large">Button</a>
                </div>
            </form>
        </div>
    </div>
    <div class="game">
        <div class="cards-container">



        </div>


        <div class="chat-area col s12">

        </div>

        <a class="modal-trigger waves-effect waves-light btn col s12" href="#modal1">Open chat</a>
    </div>

</div>


<div id="modal1" class="modal bottom-sheet">
    <div class="modal-content">
        <div class="row">

            <div class="chat-area chat-area-expanded col s12">

            </div>


            <form class="col s12">
                <div class="row">
                    <div class="input-field col s12">
                        <input id="m" type="text" class="validate">
                        <label for="m">Message</label>
                    </div>
                </div>

                <a class="message-submit-button waves-effect waves-light btn-large">Button</a>

            </form>
        </div>
    </div>
</div>




<script src="js/vendor/bootstrap.min.js"></script>

<script src="js/plugins.js"></script>

<script>

    var words,user;
    $('.game').hide();
    $(document).ready(function() {
        $('.modal-trigger').leanModal();
    });

    /*
     Event handler for room submit form
     currently no validation, will add later
     emits join room, and words. words returns array of words for bingo board
     */

    $(".submit-button").click(function (event) {
        event.preventDefault();
        var name = $("#username").val();
        var room = $("#room").val();
        user = name;
        socket.emit('join_room', {hashtag: room, username: name});

    });

    /*
     Message submit event handler
     some cheeky shiz right here lad ;)
     */

    $('.message-submit-button').click(function (event) {
        event.preventDefault();
        var message = $("#m").val();

        if (/\S/.test(message)) {
            if (message.substring(0, 1) === '/') {
                console.log('you trying some cheeky shit mate?');
                //never made a cheeky chat thingo b4 plz b gentle
                var command = message.substring(1);
                console.log(command);
                switch (command) {
                    case "baxter":
                        console.log('baxterrr');
                        message = '<img src="http://www.orionvm.com/wp-content/uploads/2014/10/headshots_orionvm_steve-baxter.jpg" alt="hi im steve" height="21" width="21">';
                        break;
                    case "leaderboard":
                        console.log('getting scores...');
                        socket.emit('get-scores');
                        break;
                }
                //more coming soon ;) ;) ;) ;) ;) ;)

            }

            $("#m").val('');

            socket.emit('message', message);
        }


    });

    /*
     Bingo board event handler
     */
    //on bingo square click
    function bingoClicked(param){
       var text = $(param).text();
        socket.emit('word-found', text);
        $(param).addClass('blue darken-4');

    }
    /*
     saves words to words var, could be useful later. displays bingo board
     */
    socket.on('words', function (data) {
        console.log(data);
        words = data.data;
        insertBingoBoard(words);
    });


    socket.on('join_room', function (data) {
        console.log(data);

        if(data.result){

            $('.input-form').fadeOut();
            socket.emit('words');
            $('.game').fadeIn();
        }else{
            printToLogLocal('Username already exists!');
        }


    });

    /*
     player found word socket event.
     */
    //data recieved {user: players[socket.id].userName, word: word}
    socket.on('player-found-word', function (data) {
        printToConsole('<strong>' + data.user + ' found ' + data.word + '</strong>', data.user);
    });

    /*
     gets current leaderboard
     */
    socket.on('get-scores', function (data) {
        console.log(data.data);
        printScores(data.data);

    });

    /*
     player joined socket event
     */
    socket.on('player-joined', function (data) {
//        printToLogLocal('<strong> Player ' + data + ' joined </strong>');
        printToConsole('<strong> Player ' + data + ' joined </strong>', data);
    });

    /*
     message socket event
     */
    socket.on('message', function (message) {
//        (message.user===user) ? printToLogLocal('<strong>' + message.user + ':</strong> ' + message.message) : printToLogServer('<strong>' + message.user + ':</strong> ' + message.message);
        printToConsole('<strong>' + message.user + ':</strong> ' + message.message, message.user);

    });

    /*
     winner found socket event
     */
    socket.on('winner-found', function (message) {
        printToLogServer(':fire: ' + message.winner + ' HAS WON THEIR BOARD :fire:')
    });

    /*
     restart game
     */
    socket.on('restart', function () {
        $('.cards-container').empty();
        socket.emit('words');
    });

    /*
     bingo board function.
     Words: string array of words to display on board
     */
    function insertBingoBoard(words) {
        var temp;
        for (var i = 0; i < words.length; i++) {
            if (!(i % 4)) {
                temp = i;
//                $("<div class='" + i + "'><div class='row cards-row'></div></div>").appendTo(".cards-container");
                $("<div class='row cards-row'id='"+i+"'></div>").appendTo(".cards-container");
            }
            var d = "<div class='card-panel bingo-square col s3 hoverable valign-wrapper blue lighten-2' onclick='bingoClicked(this)'><p class='valign center-align white-text '>" + words[i] + "</p></div> ";
            $(d).hide().appendTo("#" + temp + " ").fadeIn(500);

        }

    }

    /*
     Function which pints string input to message log
     string: string which contains what to write
     */

    function printToConsole(string, source){
        (source===user)?printToLogLocal(string):printToLogServer(string);
    }

    function printToLogLocal(string) {
//        var t = (emojify.replace('<div class="local-m"><p>' + string + '</p></div><br>'))
        console.log(t)

        var t = emojify.replace('<div class="chat-item card-panel teal"><span class="white-text">'+string+'</span></div>')
        $(t).hide().appendTo(".chat-area").fadeIn(500);
        updateLogScroll();
    }

    function printToLogServer(string){
                                                                    //BRRT BRRT BRRT
//        var t = emojify.replace('<div class="server-m"><p>' + string + '</p></div><br><br><br><br>')
        var t = emojify.replace('<div class="chat-item card-panel teal"><span class="white-text">'+string+'</span></div>')
        console.log(t);
        $(t).hide().appendTo(".chat-area").fadeIn(500);
        updateLogScroll();
    }

    /*
     print scores
     */
    function printScores(scores) {
        var scoresDiv = '';
        for (var i = 0; i < scores.length; i++) {
            scoresDiv += scores[i].username + ' : ' + scores[i].score + '<br>';
        }
        printToLogLocal(scoresDiv);
    }

    /*
     keeps scroll focused on bottom
     */
    function updateLogScroll() {
        $('.chat-area').stop().animate({
            scrollTop: $('.chat-area')[1].scrollHeight
        }, 1000);
    }


</script>

</body>
</html>
